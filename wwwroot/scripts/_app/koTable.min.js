"use strict";var log,trace,KnockoutTable;$.fn.pulse=function(n){var t={times:2,duration:250},i=function(n){$(this).animate({opacity:.2},t.duration,function(){$(this).animate({opacity:1},t.duration,n)})};this.each(function(){var r=t.times,f=this,u=function(){return r=r-1,!r&&n&&typeof n=="function"?n():i.call(f,u),r};i.call(this,u)})};ko.validation.init({parseInputAttributes:!0,errorElementClass:"has-error",errorMessageClass:"text-danger",errorClass:"has-error",decorateInputElement:!0,insertMessages:!1,messagesOnModified:!1,decorateElementOnModified:!1,grouping:{deep:!0}});log=function(n,t){!0&&t>=1&&window.console&&window.console.log&&window.console.log(n)};trace=function(n){log(n,0)};ko.bindingHandlers.koTable={init:function(n,t,i,r){function ut(){ko.validation.group(u.modalItem).find(function(n){ko.validation.utils.isValidatable(n)&&n.isModified(!1)})}var u,v,it,rt,ft,y,p,ht,l;trace("koTable init!");var o=t(),f=$(n),w=f.attr("id")||("koTable-"+$("table").index(f)).replace("-0","");f.attr("id",w);var h=w+"-modal-template",s=w+"-modal",a=f.find("thead"),e=f.find("tbody"),c=f.find("tfoot"),ct=o.pageSize||-1,g=o.rowsClickable===!0?!0:!1,lt=o.showSearch===!0?!0:!1,nt=o.allowSort===!0?!0:o.allowSort,at=o.initialSortProperty,vt=o.initialSortDirection==="asc"?"asc":"desc",b=o.showDeleteButton===!0?!0:!1,tt=o.showEditButton===!0?!0:!1,k=o.showNewButton===!0?!0:!1,yt=new KnockoutTable(ct,nt,at,vt,g);if(r.koTable={},(b||tt||k)&&(a.find("tr").each(function(n,t){$(t).prepend('<th style="width:40px; max-width:40px;padding-left:0;padding-right:0;text-align:center;"><\/th>')}),e.find("tr").each(function(n,t){var i=$(t);i.find("td [data-bind]").length&&i.prepend('<td style="padding-left:0;padding-right:0;text-align:center;" id="ko-controls-'+(new Date).getTime()+'"><\/td>')})),u=$.extend(r.koTable,yt),r.koTable.addRowClickedHandler=function(n){n&&typeof n=="function"&&(v=n)},r.koTable.addRowDeleteHandler=function(n){n&&typeof n=="function"&&(it=n)},r.koTable.addRowSaveHandler=function(n){n&&typeof n=="function"&&(rt=n)},u.overrideModalTemplateId=function(n){h=n},r.koTableReady.call(),(tt||k)&&(e.find("tr").each(function(n,t){var i=$(t);i.find("td [data-bind]").length&&i.find("td:first").prepend('<a class="edit-btn" style="cursor:pointer;margin-left:'+(b?"3px":"0")+';"><span class="glyphicon glyphicon-edit text-default small" style="margin:0;"><\/span><\/a>')}),u.modalRow=undefined,u.modalOriginalItem=undefined,u.modalItem=undefined,u.modalItemReady=ko.observable(!1),u.modalItemIsModified=ko.pureComputed(function(){var n=!1;return u.modalItemReady&&(n=!!ko.validation.group(u.modalItem).find(function(n){return ko.validation.utils.isValidatable(n)&&n.isModified()})),n}),ft='<div class="modal fade" id="'+s+'" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">                <div class="modal-dialog" role="document">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close close-button" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button>                            <h4 class="modal-title">Edit Record<\/h4>                        <\/div>                        <div class="modal-body" data-bind="template: { name: \''+h+'\', if: $data.koTable.modalItemReady(), data: $data.koTable }"><\/div>                        <div class="modal-footer">                            <button type="button" class="btn btn-default btn-sm close-button"><span class="glyphicon glyphicon-remove"><\/span>&nbsp;Cancel<\/button>                            <button type="button" class="btn btn-primary btn-sm save-button" data-bind="disable: !$data.koTable.modalItemReady() || !$data.koTable.modalItemIsModified() || !$data.koTable.modalItem.isValid()"><span class="glyphicon glyphicon-floppy-disk"><\/span>&nbsp;Save<\/button>                        <\/div>                    <\/div>                <\/div>            <\/div>',c.length||(f.append("<tfoot><tr><td><\/td><\/tr><\/tfoot>"),c=f.find("tfoot")),c.find("td:first").append(ft),f.find("#"+s+" .close-button").click(function(){f.find("#"+s).modal("hide");u.modalRow&&u.modalRow.find("td.bg-info").removeClass("bg-info")}),f.find("#"+s+" .save-button").click(function(){u.modalItem()?rt({model:ko.mapping.toJS(u.modalItem()),completedCallback:function(n){var i,t;f.find("#"+s).modal("hide");i=ko.mapping.toJS(u.modalItem());y&&n?u.pushItem(i):ko.mapping.fromJS(i,u.modalOriginalItem);t=u.modalRow;t&&t.find("td").addClass("bg-info").pulse(function(){t.find("td").removeClass("bg-info")})}}):f.find("#"+s).modal("hide")})),b===!0&&e.find("tr").each(function(n,t){var i=$(t);i.find("td [data-bind]").length&&i.find("td:first").prepend('<a class="delete-btn" style="cursor:pointer;margin-right:5px;"><span class="glyphicon glyphicon-trash text-danger small" style="margin:0;"><\/span><\/a>')}),k===!0&&a.find("tr").each(function(n,t){$(t).find("th:first").css({padding:"0 0 4px 0","text-align":"center"}).append('<a style="padding: 0px 5px 1px 6px;margin-bottom:3px;" class="btn btn-default btn-sm new-btn"><span class="glyphicon glyphicon-plus text-info small" style="margin:0;padding:0;"><\/span><\/a>')}),y=!1,p=function(n){var t=$(n.target),i,o,r,e,c,f;if(t&&(i=$(n.target).closest("tr"),i&&i.length>=0&&(o=i.get(0),o)))if(r=ko.dataFor(i.get(0)),t.closest("thead").length||t.closest("tfoot").length||t.closest(".ko-table-search").length||t.closest("button").length||t.closest("a").length){if(t.closest(".delete-btn").length){$("td").removeClass("danger");$(".popover").popover("destroy");i.find("td").addClass("danger");e="#"+t.closest("td").attr("id");console.log(e);t.popover({trigger:"manual",container:e,placement:"right",html:!0,content:'<div class="btn-group"><a class="btn btn-sm btn-danger confirm-yes" data-dismiss="confirmation" href="#" target="_self"><i class="glyphicon glyphicon-ok"><\/i><\/a><a class="btn btn-default btn-sm confirm-no" data-dismiss="confirmation"><i class="glyphicon glyphicon-remove"><\/i><\/a><\/div>'}).popover("show");$(".confirm-yes").one("click",function(n){return $(".popover").popover("destroy"),it({event:n,tr:i,model:ko.mapping.toJS(r),completedCallback:function(){i.find("td").pulse(function(){u.removeItem(r)})}}),n.preventDefault(),!0});$(".confirm-no").one("click",function(n){return $("td").removeClass("danger"),$(".popover").popover("destroy"),n.preventDefault(),!0})}else if(t.closest(".edit-btn").length){if(y=!1,$("td").removeClass("danger"),$(".popover").popover("destroy"),!$("#"+h).length){alert("A template with id ["+h+"] was not found.");return}u.modalItem?ko.mapping.fromJS(ko.mapping.toJS(r),u.modalItem()):(u.modalItem=ko.validatedObservable(ko.mapping.fromJS(ko.mapping.toJS(r))),u.modalItemReady(!0));u.modalRow=i;u.modalOriginalItem=r;i.find("td").addClass("bg-info");ut();$("#"+s+" .modal-title").text("Edit Record");$("#"+s).modal({backdrop:"static"})}else if(t.closest(".new-btn").length){if(y=!0,$("td").removeClass("danger"),$(".popover").popover("destroy"),!$("#"+h).length){alert("A template with id ["+h+"] was not found.");return}c=$($.parseHTML($("#"+h).get(0).innerText)).find("input");f={};c.each(function(n,t){f[t.name]=undefined});u.modalItem?ko.mapping.fromJS(f,u.modalItem()):(u.modalItem=ko.validatedObservable(ko.mapping.fromJS(f)),u.modalItemReady(!0));u.modalRow=undefined;u.modalOriginalItem=undefined;ut();$("#"+s+" .modal-title").text("New Record");$("#"+s).modal({backdrop:"static"})}}else v&&typeof v=="function"&&v({event:n,tr:i,model:r})},u.rowsClickable.subscribe(function(n){e.css("cursor","default");e.off("click");n===!0&&e.length&&e.css("cursor","pointer");e.click(p)}),e.css("cursor","default"),e.off("click"),g&&e.css("cursor","pointer"),a.length?a.click(p):e.length||$.error("The table has no thead element so clicking will not be enabled!"),e.length?e.click(p):e.length||$.error("The table has no tbody element so clicking will not be enabled!"),nt){var et='<span class="sort-icon glyphicon glyphicon-triangle-bottom" aria-hidden="true" style="margin-left:5px; color:silver; font-size: 10px;"><\/span>',ot='<span class="sort-icon glyphicon glyphicon-triangle-top" aria-hidden="true" style="margin-left:5px; color:silver; font-size: 10px;"><\/span>',d=f.find("[data-sort-property]");d.css("cursor","pointer");var pt=u.sortDirection(),wt=u.sortProperty(),st=f.find("[data-sort-property='"+wt+"']");pt==="desc"?st.append(et):st.append(ot);d.click(function(){d.find(".sort-icon").remove();var i=u.sortProperty(),n=$(this).attr("data-sort-property"),t="asc";i===n?t=u.toggleSortDirection():u.sortProperty(n);t==="desc"?$(this).append(et):$(this).append(ot)})}if(c.length?c.find("td:first").append('<div class="ko-table-pagination"><\/div>'):(f.append('<tfoot><tr><td><div class="ko-table-pagination"><\/div><\/td><\/tr><\/tfoot>'),c=f.find("tfoot")),$.each(f.find(".ko-table-pagination"),function(n,t){$(t).html('<span data-bind="if: !koTable.hasRows()">There are no records to show at the moment :(<\/span><ul class="pagination" data-bind="if: koTable.paginationRequired()" style="padding: 0 !important; margin: 5px 0 5px 0 !important;" ><li data-bind="css: { disabled: koTable.isFirstPage }"><a href="#" data-bind="click: koTable.gotoFirstPage"><span class="glyphicon glyphicon-step-backward" aria-hidden="true"><\/span><\/a><\/li><li data-bind="css: { disabled: koTable.isFirstPage }"><a href="#" data-bind="click: koTable.gotoPreviousPage"><span class="glyphicon glyphicon-backward" aria-hidden="true"><\/span><\/a><\/li><!-- ko foreach: koTable.paginationIndexes() --><li data-bind="css: { active: $data==$parent.koTable.currentPage() }"><a href="#" data-bind="click: $parent.koTable.gotoPage"><span data-bind="text: ($data+1)"><\/span><\/a><\/li><!-- /ko --><li data-bind="css: { disabled: koTable.isLastPage }"><a href="#" data-bind="click: koTable.gotoNextPage"><span class="glyphicon glyphicon-forward" aria-hidden="true"><\/span><\/a><\/li><li data-bind="css: { disabled: koTable.isLastPage }"><a href="#" data-bind="click: koTable.gotoLastPage"><span class="glyphicon glyphicon-fast-forward" aria-hidden="true"><\/span><\/a><\/li><\/ul><div class="text-muted pull-right" style="height:34px; line-height:34px;" data-bind="visable: koTable.rowCount(), text: \'Row Count: \' + koTable.rowCount()"><\/div>').closest("td, th").css({"padding-left":0,"padding-right":0,"text-align":"left"}).attr("colspan",100)}),lt){a.append('<tr><th colspan="1000"><div class="ko-table-search"><\/div><\/th><\/tr>');l=f.find(".ko-table-search");l.addClass("input-group").css({width:"100%"});l.html('<span class="glyphicon glyphicon-search input-group-addon input-group-sm" style="top: 0;"><\/span><input type="text" class="form-control" placeholder="search..." value="" />');l.find("input[type='text']").on("input",function(n){clearTimeout(ht);ht=setTimeout(function(){var i=$(n.target),r=i.val(),t=l.find("span:first");if(t.removeClass("glyphicon-search").removeClass("glyphicon-remove"),r.length>0)t.addClass("glyphicon-remove").css({cursor:"pointer"}).one("click",function(){t.removeClass("glyphicon-remove").addClass("glyphicon-search").css({cursor:"default"});i.val("").trigger("input")});else t.addClass("glyphicon-search");u.setRowFilter(r)},500)});l.closest("td, th").css({"padding-left":0,"padding-right":0}).attr("colspan",100).closest("tr")}else f.find(".ko-table-search").closest("td, th").attr("colspan",100).hide()}};KnockoutTable=function(){function n(n,t,i,r,u){function w(n,t){trace("objectSortComparer...");var u=ko.unwrap(n),e=ko.unwrap(t),i=ko.unwrap(u[f.sortProperty()]),r=ko.unwrap(e[f.sortProperty()]);return typeof i=="string"&&(i=i.toUpperCase(),r=r.toUpperCase()),f.sortDirection()==="desc"?i<r?1:i>r?-1:0:i<r?-1:i>r?1:0}var f=this,l=5,p={onRowClicked:"onRowClicked",onRowsClickableChanged:"onRowsClickableChanged",onRowDeleteClicked:"onRowDeleteClicked"},e=ko.observableArray([]),s=ko.observable({allowSort:t,sortProperty:i,sortDirection:$.trim(r||"asc").toLowerCase()}),o=ko.observable(n&&n>0?n:-1),a=ko.observable(u===!0),v=ko.observable(""),h,c,y;f.currentPage=ko.observable(0);f.setRowFilter=function(n){trace("setRowFilter...");var t=ko.unwrap(n);$.trim(t.toString()).length>=2?v(t.toString().toLowerCase()):v("")};h=ko.pureComputed({read:function(){var n,t;return(trace(["read items...",e()]),n=ko.unwrap(v),n&&n.length)?(t=[],$.each(e(),function(i,r){var u=ko.mapping.toJS(r),f,e,o;for(f in u)if(u.hasOwnProperty(f)&&(e=(u[f]===undefined?"":u[f]).toString().toLowerCase(),o=e.indexOf(n)>=0,o)){t.push(r);break}}),t):e()},write:function(n){trace("write items...");e(n)}},f);f.rowsClickable=ko.computed({read:function(){return trace("rowsClickable...read"),a()},write:function(n){trace("rowsClickable...write");var i=a(),t=n===!0?!0:!1;n===!1||n||(t=t?!1:!0);i!==t&&(y(p.onRowsClickableChanged,t),a(t))}},f);f.pageSize=ko.computed({read:function(){return trace("pageSize...read"),o()},write:function(n){trace("pageSize...write");var t=o(),i=parseInt(n);t!==i&&(n=Math.max(1,n),o(n))}},f);f.sortProperty=ko.computed({read:function(){return trace("sortProperty...read"),s().sortProperty},write:function(n){var r,i,t;trace("sortProperty...write");r=s().sortProperty;i=$.trim(ko.unwrap(n));r!==i&&(t=s(),t.sortProperty=i,t.sortDirection="asc",s(t))}},f);f.sortDirection=ko.pureComputed({read:function(){return trace("sortDirection...read"),s().sortDirection},write:function(n){var r,t,i;trace("sortDirection...write");r=s().sortDirection;t=$.trim(ko.unwrap(n)||"asc").toLowerCase();r!==t&&(i=s(),i.sortDirection=t,s(i))}},f);f.toggleSortDirection=function(){trace("toggleSortDirection...");var t=f.sortDirection(),n=t==="asc"?"desc":"asc";return f.sortDirection(n),n};f.clearItems=function(){trace("clearItems...");e([]);f.currentPage(-1);f.currentPage(0)};f.pushItem=function(n){trace("pushItem...");e.push(ko.mapping.fromJS(ko.mapping.toJS(n)))};f.allItems=function(){return trace("allItems..."),e()};f.observableItems=function(){return trace("observableItems..."),e};f.distinctValues=function(n,t){trace("distinctValues...");var i=[];return(t===undefined||typeof t!="function")&&(t=function(n){return n===undefined?"":n.toString()}),$.each(e(),function(r,u){var e=ko.unwrap(u),f=ko.unwrap(e[n]);f=t(f);$.inArray(f,i)===-1&&i.push(f)}),i.sort()};f.setItems=function(n){trace("setItems...");f.clearItems();var t=n||[];t=$.map(t,function(n){var t=ko.mapping.toJS(n);return ko.mapping.fromJS(t)});e(t)};f.findItem=function(n,t){trace("findItem...");var i=ko.unwrap(t);return $.grep(e(),function(t){var r=ko.unwrap(t),u=ko.unwrap(r[n]);return u===i})};f.removeItem=function(n){trace("removeItem...");var t=$.grep(e(),function(t){return n===t});$.each(t,function(n,t){e.remove(t)})};f.gotoNextPage=function(){trace("gotoNextPage...");f.currentPage()<f.pageCount()-1&&f.currentPage(f.currentPage()+1)};f.gotoPreviousPage=function(){trace("gotoPreviousPage...");f.currentPage()>0&&f.currentPage(f.currentPage()-1)};f.gotoLastPage=function(){trace("gotoLastPage...");f.currentPage(f.pageCount()-1)};f.gotoFirstPage=function(){trace("gotoFirstPage...");f.currentPage(0)};f.gotoPage=function(n){trace("gotoPage...");var t=n||0;t!==f.currentPage()&&f.currentPage(t)};f.isFirstPage=ko.pureComputed(function(){return trace("isFirstPage..."),f.currentPage()===0});f.isLastPage=ko.pureComputed(function(){return trace("isLastPage..."),f.currentPage()===f.pageCount()-1});f.pageCount=ko.pureComputed(function(){return trace("pageCount..."),Math.ceil(o()>0?h().length/o()||1:1)});f.paginationIndexes=ko.pureComputed(function(){var n;trace("paginationIndexes...");var u=(l-1)/2,t=Math.min(Math.max(f.currentPage()+u,f.currentPage()+l),f.pageCount()),i=Math.max(0,t-l),r=[];for(n=0;n<t-i;n++)r.push(i+n);return r});f.pagedItems=ko.pureComputed(function(){var n=o()>0?o()*f.currentPage():0,i=o()>0?n+o():f.rowCount(),t;return t=f.sortProperty()?h().sort(w).slice(n,i):h().slice(n,i),trace("pagedItems... "+t.length),t});f.hasRows=ko.pureComputed(function(){return trace("hasRows..."),h()&&h().length>0},f);f.paginationRequired=ko.pureComputed(function(){return trace("paginationRequired..."),f.hasRows()&&f.pageCount()>1},f);f.rowCount=ko.pureComputed(function(){return trace("rowCount..."),f.hasRows()?h().length:0});c={};y=function(n,t){var r,i,u;if(trace("trigger..."),typeof n=="string"&&(n={type:n}),n.data=t,n.target||(n.target=f),n.type||$.error("Event object missing 'type' property."),c[n.type]instanceof Array)for(r=c[n.type],i=0,u=r.length;i<u;i++)r[i].call(f,n)};f.removeListener=function(n,t){var r,i,u;if(trace("removeListener..."),c[n]instanceof Array)for(r=c[n],i=0,u=r.length;i<u;i++)if(r[i]===t){r.splice(i,1);break}}}return n}();
//# sourceMappingURL=koTable.min.js.map
